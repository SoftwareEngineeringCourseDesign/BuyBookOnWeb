webpackJsonp([17],{Cn2j:function(t,e,r){(t.exports=r("FZ+f")(!1)).push([t.i,".back[data-v-2eced04e]{margin:50px;text-align:right}.order[data-v-2eced04e]{width:90%;margin:50px}",""])},PxWg:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r("teIl"),s=r("PJh5"),a=r.n(s),n=r("BTaQ"),i=r.n(n),c={components:{iHeader:o.a},name:"",data:function(){var t=this;return{order:[],orderList:[],book:[],columns:[{title:"购买书籍",key:"msg",render:function(t,e){return t("div",[t("img",{attrs:{height:"100px",src:e.row.msg.img}}),t("b",e.row.msg.name)])}},{title:"分类",key:"category"},{title:"出版商",key:"publisher"},{title:"单价",key:"price"},{title:"数量",key:"number"},{title:"优惠方式",key:"discount"},{title:"总金额",key:"sum"}],columns2:[{title:"订单编号",key:"id"},{title:"下单用户",key:"username"},{title:"总金额",key:"sum"},{title:"创建时间",key:"createTime"},{title:"订单状态",key:"step",render:function(e,r){return e("div",t.GetStepMessage(r.row.step))}},{title:"操作",render:function(e,r){return e("div",{style:{"text-align":"center"}},t.getContent(e))}}],user:[],score:0}},created:function(){var t=this;this.$http.get("user/"+this.$store.state.auth.authUser,{params:{token:this.$store.state.auth.token}}).then(function(e){t.user=e.data}).catch(function(e){i.a.Notice.error({title:"暂未登录"}),t.$router.push({name:"Login"})}),this.$http.get("order/"+this.$route.params.order_id,{params:{token:this.$store.state.auth.token}}).then(function(e){t.order=e.data,t.$http.get("book/"+t.order.book.id).then(function(e){var r=e.data;r.category=r.category.name,r.price=t.toDecimal2(r.price/100),r.number=t.order.number,r.sum=t.toDecimal2(t.order.price/100),r.discount="无优惠",r.msg={img:e.data.cover,name:e.data.name},t.book=[r],t.order.sum=t.toDecimal2(t.order.price/100),t.order.createTime=a.a.unix(+t.order.created_at).format("YYYY-MM-DD"),t.order.username=t.order.user.name,t.orderList=[t.order]}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该书"}),t.$router.push({name:"UserInfo"})}})}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该订单"}),t.$router.push({name:"UserInfo"})}}),document.title="订单详情"+window.title_suf},computed:{},methods:{GetStepMessage:function(t){var e="";switch(t){case 1:e="未支付";break;case 2:e="待发货";break;case 3:e="已发货";break;case 4:e="已收货";break;case 5:e="已评分";break;default:e="未知状态"}return e},toDecimal2:function(t){var e=(Math.round(100*t)/100).toString(),r=e.indexOf(".");for(r<0&&(r=e.length,e+=".");e.length<=r+2;)e+="0";return"￥"+e},getContent:function(t){var e=this,r=void 0;return"root"===this.user.role.alias?r=[]:"person"===this.user.role.alias?1===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.Pay()}}},"立即支付")]:2===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.$Message.info("已通知商家尽快发货")}}},"催促商家发货")]:3===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.Receive()}}},"确认收货")]:4===this.order.step?r=[t("Rate",{props:{value:this.score,"show-text":!1,count:5,"allow-half":!0},on:{input:function(t){e.score=t}}}),t("Button",{props:{type:"primary"},style:{"margin-top":"10px","margin-bottom":"10px"},on:{click:function(){e.Star()}}},"提交评分")]:5===this.order.step&&(r=[t("Button",{props:{type:"primary"},on:{click:function(){e.$Message.info("暂未开放评论功能")}}},"追加评论")]):"bookseller"===this.user.role.alias?1===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.$Message.info("已提醒用户付款")}}},"提醒用户付款")]:2===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.Send()}}},"确认发货")]:3===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.$Message.info("已提醒用户收货")}}},"提醒用户收货")]:4===this.order.step?r=[t("Button",{props:{type:"error"},on:{click:function(){e.$Message.info("已提醒用户评分")}}},"提醒用户评分")]:5===this.order.step&&(r=[t("Button",{props:{type:"primary"},on:{click:function(){e.$Message.info("暂未开放评论功能")}}},"查看评论")]):r=[],r},Pay:function(){var t=this;this.$http.put("order/"+this.order.id+"/pay",{token:this.$store.state.auth.token}).then(function(e){t.$http.get("order/"+t.$route.params.order_id,{params:{token:t.$store.state.auth.token}}).then(function(e){t.order.step=e.data.step,t.$Notice.info({title:"支付成功"})}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该订单"}),t.$router.push({name:"UserInfo"})}})}).catch(function(t){switch(t.response.status){case 404:i.a.Notice.error({title:"找不到该订单"});break;case 402:i.a.Notice.error({title:"该订单已支付成功"});break;case 403:i.a.Notice.error({title:t.response.data.message})}})},Receive:function(){var t=this;this.$http.put("order/"+this.order.id+"/receive",{token:this.$store.state.auth.token}).then(function(e){t.$http.get("order/"+t.$route.params.order_id,{params:{token:t.$store.state.auth.token}}).then(function(e){t.order.step=e.data.step,t.$Notice.info({title:"成功确认收货"})}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该订单"}),t.$router.push({name:"UserInfo"})}})}).catch(function(t){switch(t.response.status){case 404:i.a.Notice.error({title:"找不到该订单"});break;case 402:i.a.Notice.error({title:"该订单已支付成功"})}})},Star:function(){var t=this;this.$http.put("order/"+this.order.id+"/evaluate",{token:this.$store.state.auth.token,score:Math.round(2*this.score)}).then(function(e){t.$http.get("order/"+t.$route.params.order_id,{params:{token:t.$store.state.auth.token}}).then(function(e){t.order.step=e.data.step,t.$Notice.info({title:"成功评分"})}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该订单"}),t.$router.push({name:"UserInfo"})}})}).catch(function(t){switch(t.response.status){case 404:i.a.Notice.error({title:"找不到该订单"});break;case 402:i.a.Notice.error({title:"该订单已支付成功"})}})},Send:function(){var t=this;this.$http.put("order/"+this.order.id+"/send",{token:this.$store.state.auth.token}).then(function(e){t.$http.get("order/"+t.$route.params.order_id,{params:{token:t.$store.state.auth.token}}).then(function(e){t.order.step=e.data.step,t.$Notice.info({title:"发货成功"})}).catch(function(e){switch(e.response.status){case 401:i.a.Notice.error({title:"您未登录"}),t.$router.push({name:"Login"});break;case 403:i.a.Notice.error({title:"您没有权限"}),t.$router.push({name:"UserInfo"});break;case 404:i.a.Notice.error({title:"找不到该订单"}),t.$router.push({name:"UserInfo"})}})}).catch(function(t){switch(t.response.status){case 404:i.a.Notice.error({title:"找不到该订单"})}})}}},u={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("i-header"),t._v(" "),r("h1",{staticStyle:{"text-align":"center","margin-top":"20px"}},[t._v("订单详情")]),t._v(" "),r("div",{staticClass:"order"},[r("h2",{staticStyle:{"margin-bottom":"10px"}},[t._v("订单内容")]),t._v(" "),r("Table",{attrs:{border:"",columns:t.columns,data:t.book}}),t._v(" "),r("h2",{staticStyle:{"margin-top":"20px"}},[t._v("订单信息")]),t._v(" "),r("Table",{attrs:{border:"",columns:t.columns2,data:t.orderList}})],1),t._v(" "),r("div",{staticClass:"back"},[r("Button",{attrs:{type:"primary"},on:{click:function(e){t.$router.back()}}},[t._v("返回上一页")])],1)],1)},staticRenderFns:[]};var p=r("VU/8")(c,u,!1,function(t){r("a0Rh")},"data-v-2eced04e",null);e.default=p.exports},a0Rh:function(t,e,r){var o=r("Cn2j");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);r("rjj0")("29caedce",o,!0,{})}});
//# sourceMappingURL=17.4fbf365f0fe47912d7ee.js.map